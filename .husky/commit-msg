#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

# Get current branch name
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)

# Extract the number at the start of the branch name
BRANCH_NUMBER=$(echo "$BRANCH_NAME" | grep -oE '^[0-9]+')

# Get the commit message
COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# If branch number exists and isn't already prefixed, update commit message
if [ -n "$BRANCH_NUMBER" ] && ! echo "$COMMIT_MSG" | grep -qE "^$BRANCH_NUMBER "; then
  echo "$BRANCH_NUMBER $COMMIT_MSG" > "$COMMIT_MSG_FILE"
fi
